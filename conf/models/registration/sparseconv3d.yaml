models:
  Sparse_Unet_Fragment:
    class: sparseconv3d.APIModel
    conv_type: "SPARSE"
    backend: "torchsparse"
    loss_mode: "match"
    define_constants:
      in_feat: 32
      out_feat: 32
    post_mlp_nn: [2*infeat, out_feat]
    backbone:
      down_conv:
        module_name: ResNetDown
        down_conv_nn:
          [
            [FEAT, in_feat],
            [in_feat, 2* in_feat],
            [2* in_feat, 2 * in_feat],
            [2 * in_feat, 4 * in_feat],
          ]
        kernel_size: [5, 3, 3, 3]
        stride: [1, 2, 2, 2]
        dilation: [1, 1, 1, 1]
      up_conv:
        module_name: ResNetUp
        up_conv_nn:
          [
            [4*in_feat, 2*in_feat],
            [2*in_feat + 2*in_feat, 2*in_feat],
            [2*in_feat + 2*in_feat, 2*in_feat],
            [2*in_feat + in_feat, 2*in_feat],
          ]
        kernel_size: [3, 3, 3, 3]
        stride: [2, 2, 2, 1]
        dilation: [1, 1, 1, 1]

    normalize_feature: True
    metric_loss:
      class: "ContrastiveHardestNegativeLoss"
      params:
        num_pos: 1024
        num_hn_samples: 256
        pos_thresh: 0.1
        neg_thresh: 1.4
